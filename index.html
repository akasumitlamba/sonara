<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Offline Music Player</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap');
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', sans-serif;
            background: #0a0a0a;
            background-image: 
                radial-gradient(circle at 20% 50%, rgba(120, 119, 198, 0.1) 0%, transparent 50%),
                radial-gradient(circle at 80% 20%, rgba(255, 119, 198, 0.1) 0%, transparent 50%),
                radial-gradient(circle at 40% 80%, rgba(120, 219, 226, 0.1) 0%, transparent 50%);
            min-height: 100vh;
            color: #ffffff;
            overflow-x: hidden;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            text-align: center;
            margin-bottom: 30px;
        }

        .header h1 {
            font-size: 2.8rem;
            font-weight: 700;
            margin-bottom: 10px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 50%, #f093fb 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .header p {
            font-size: 1.1rem;
            color: #a0a0a0;
            font-weight: 300;
        }

        .main-content {
            display: grid;
            grid-template-columns: 1fr 400px;
            gap: 30px;
            align-items: start;
        }

        .left-panel {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        .file-input-section {
            background: rgba(255,255,255,0.05);
            backdrop-filter: blur(20px);
            border-radius: 20px;
            padding: 25px;
            border: 1px solid rgba(255,255,255,0.1);
            box-shadow: 0 8px 32px rgba(0,0,0,0.3);
        }

        .input-group {
            display: flex;
            gap: 15px;
            justify-content: center;
        }

        .file-input-wrapper {
            position: relative;
            overflow: hidden;
        }

        .file-input {
            position: absolute;
            left: -9999px;
        }

        .file-input-label {
            background: rgba(255,255,255,0.08);
            border: 1px solid rgba(255,255,255,0.15);
            border-radius: 12px;
            padding: 14px 20px;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 10px;
            font-weight: 500;
            color: #ffffff;
        }

        .file-input-label:hover {
            background: rgba(255,255,255,0.12);
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(0,0,0,0.3);
        }

        .player-section {
            background: rgba(255,255,255,0.05);
            backdrop-filter: blur(20px);
            border-radius: 25px;
            padding: 40px;
            border: 1px solid rgba(255,255,255,0.1);
            box-shadow: 0 8px 32px rgba(0,0,0,0.3);
        }

        .player-top {
            display: flex;
            gap: 30px;
            margin-bottom: 30px;
            align-items: center;
        }

        .vinyl-container {
            position: relative;
            width: 120px;
            height: 120px;
            flex-shrink: 0;
        }

        .vinyl-disk {
            width: 120px;
            height: 120px;
            background: radial-gradient(circle, #1a1a1a 20%, #333 22%, #1a1a1a 25%, #333 27%, #000 30%);
            border-radius: 50%;
            position: relative;
            transition: transform 0.3s ease;
            box-shadow: 0 8px 25px rgba(0,0,0,0.4);
        }

        .vinyl-disk::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 25px;
            height: 25px;
            background: #000;
            border-radius: 50%;
            box-shadow: inset 0 0 10px rgba(255,255,255,0.1);
        }

        .vinyl-disk::after {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 8px;
            height: 8px;
            background: #333;
            border-radius: 50%;
        }

        .vinyl-disk.spinning {
            animation: spin 3s linear infinite;
        }

        @keyframes spin {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }

        .now-playing {
            flex: 1;
        }

        .song-title {
            font-size: 1.8rem;
            font-weight: 600;
            margin-bottom: 8px;
            color: #ffffff;
        }

        .song-info {
            color: #a0a0a0;
            font-size: 1rem;
            margin-bottom: 15px;
        }

        .song-meta {
            display: flex;
            gap: 20px;
            font-size: 0.9rem;
            color: #888;
        }

        .progress-container {
            margin: 30px 0;
        }

        .progress-bar {
            width: 100%;
            height: 6px;
            background: rgba(255,255,255,0.1);
            border-radius: 3px;
            cursor: pointer;
            position: relative;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #667eea, #764ba2);
            border-radius: 3px;
            width: 0%;
            transition: width 0.1s ease;
        }

        .time-info {
            display: flex;
            justify-content: space-between;
            margin-top: 12px;
            font-size: 0.9rem;
            color: #a0a0a0;
            font-weight: 400;
        }

        .controls {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 20px;
            margin: 25px 0;
        }

        .control-btn {
            background: rgba(255,255,255,0.08);
            border: none;
            border-radius: 50%;
            width: 48px;
            height: 48px;
            color: white;
            cursor: pointer;
            font-size: 18px;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            border: 1px solid rgba(255,255,255,0.1);
        }

        .control-btn:hover {
            background: rgba(255,255,255,0.15);
            transform: scale(1.05);
        }

        .control-btn.active {
            background: linear-gradient(135deg, #667eea, #764ba2);
            box-shadow: 0 0 20px rgba(102, 126, 234, 0.4);
        }

        .play-pause-btn {
            width: 64px;
            height: 64px;
            font-size: 24px;
            background: linear-gradient(135deg, #667eea, #764ba2);
            box-shadow: 0 8px 25px rgba(102, 126, 234, 0.3);
        }

        .play-pause-btn:hover {
            transform: scale(1.05);
            box-shadow: 0 12px 35px rgba(102, 126, 234, 0.4);
        }

        .volume-container {
            display: flex;
            align-items: center;
            gap: 15px;
            justify-content: center;
            margin: 25px 0 0 0;
        }

        .volume-icon {
            font-size: 18px;
            color: #a0a0a0;
        }

        .volume-slider {
            width: 120px;
            height: 4px;
            background: rgba(255,255,255,0.1);
            border-radius: 2px;
            outline: none;
            cursor: pointer;
            -webkit-appearance: none;
        }

        .volume-slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 16px;
            height: 16px;
            background: linear-gradient(135deg, #667eea, #764ba2);
            border-radius: 50%;
            cursor: pointer;
            box-shadow: 0 2px 10px rgba(102, 126, 234, 0.3);
        }

        .volume-value {
            font-size: 0.9rem;
            color: #a0a0a0;
            min-width: 35px;
        }

        .queue-section {
            background: rgba(255,255,255,0.05);
            backdrop-filter: blur(20px);
            border-radius: 20px;
            padding: 25px;
            border: 1px solid rgba(255,255,255,0.1);
            box-shadow: 0 8px 32px rgba(0,0,0,0.3);
            height: fit-content;
            max-height: 80vh;
            display: flex;
            flex-direction: column;
        }

        .queue-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .queue-title {
            font-size: 1.4rem;
            font-weight: 600;
            color: #ffffff;
        }

        .queue-count {
            background: rgba(255,255,255,0.1);
            padding: 4px 12px;
            border-radius: 12px;
            font-size: 0.85rem;
            color: #a0a0a0;
        }

        .queue-controls {
            display: flex;
            gap: 10px;
        }

        .queue-btn {
            background: rgba(255,255,255,0.08);
            border: none;
            border-radius: 8px;
            padding: 8px 12px;
            color: #ffffff;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 0.85rem;
            border: 1px solid rgba(255,255,255,0.1);
        }

        .queue-btn:hover {
            background: rgba(255,255,255,0.15);
        }

        .queue {
            flex: 1;
            overflow-y: auto;
            margin-bottom: 10px;
        }

        .queue::-webkit-scrollbar {
            width: 6px;
        }

        .queue::-webkit-scrollbar-track {
            background: rgba(255,255,255,0.05);
            border-radius: 3px;
        }

        .queue::-webkit-scrollbar-thumb {
            background: rgba(255,255,255,0.2);
            border-radius: 3px;
        }

        .queue-item {
            display: flex;
            align-items: center;
            gap: 15px;
            padding: 12px;
            margin-bottom: 8px;
            background: rgba(255,255,255,0.05);
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.3s ease;
            border: 1px solid rgba(255,255,255,0.05);
            user-select: none;
        }

        .queue-item:hover {
            background: rgba(255,255,255,0.1);
            transform: translateX(4px);
        }

        .queue-item.playing {
            background: linear-gradient(135deg, rgba(102, 126, 234, 0.2), rgba(118, 75, 162, 0.2));
            border: 1px solid rgba(102, 126, 234, 0.3);
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.2);
        }

        .queue-item.dragging {
            opacity: 0.5;
            transform: rotate(5deg);
        }

        .queue-item.drag-over {
            border-top: 2px solid #667eea;
        }

        .drag-handle {
            color: #666;
            cursor: grab;
            font-size: 16px;
        }

        .drag-handle:active {
            cursor: grabbing;
        }

        .track-number {
            width: 24px;
            height: 24px;
            border-radius: 50%;
            background: rgba(255,255,255,0.1);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.8rem;
            color: #a0a0a0;
            font-weight: 500;
        }

        .queue-item.playing .track-number {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
        }

        .song-details {
            flex: 1;
            min-width: 0;
        }

        .song-details h4 {
            font-size: 0.95rem;
            font-weight: 500;
            color: #ffffff;
            margin-bottom: 4px;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }

        .song-meta-small {
            font-size: 0.8rem;
            color: #888;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }

        .duration {
            color: #a0a0a0;
            font-size: 0.85rem;
            font-weight: 400;
        }

        .empty-state {
            text-align: center;
            padding: 40px 20px;
            color: #666;
        }

        .empty-state h3 {
            margin-bottom: 10px;
            color: #888;
            font-weight: 500;
        }

        .empty-state p {
            font-size: 0.9rem;
        }

        /* Icons using Unicode symbols for better compatibility */
        .icon-folder::before { content: 'üìÅ'; }
        .icon-files::before { content: 'üéµ'; }
        .icon-volume::before { content: 'üîä'; }
        .icon-volume-mute::before { content: 'üîá'; }
        .icon-shuffle::before { content: 'üîÄ'; }
        .icon-repeat::before { content: 'üîÅ'; }
        .icon-repeat-one::before { content: 'üîÇ'; }
        .icon-prev::before { content: '‚èÆÔ∏è'; }
        .icon-next::before { content: '‚è≠Ô∏è'; }
        .icon-play::before { content: '‚ñ∂Ô∏è'; }
        .icon-pause::before { content: '‚è∏Ô∏è'; }
        .icon-drag::before { content: '‚ãÆ‚ãÆ'; }

        @media (max-width: 1024px) {
            .main-content {
                grid-template-columns: 1fr;
                gap: 20px;
            }
            
            .queue-section {
                max-height: 400px;
            }
        }

        @media (max-width: 768px) {
            .container {
                padding: 15px;
            }

            .header h1 {
                font-size: 2.2rem;
            }

            .player-top {
                flex-direction: column;
                text-align: center;
                gap: 20px;
            }

            .vinyl-container {
                width: 100px;
                height: 100px;
            }

            .vinyl-disk {
                width: 100px;
                height: 100px;
            }

            .controls {
                gap: 15px;
            }

            .control-btn {
                width: 44px;
                height: 44px;
                font-size: 16px;
            }

            .play-pause-btn {
                width: 56px;
                height: 56px;
                font-size: 20px;
            }

            .input-group {
                flex-direction: column;
                gap: 10px;
            }

            .queue-section {
                max-height: 300px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üéµ Music Player</h1>
            <p>Your premium offline music experience</p>
        </div>

        <div class="main-content">
            <div class="left-panel">
                <div class="file-input-section">
                    <div class="input-group">
                        <div class="file-input-wrapper">
                            <input type="file" id="fileInput" class="file-input" accept="audio/*" multiple>
                            <label for="fileInput" class="file-input-label">
                                <span class="icon-files"></span>
                                Select Songs
                            </label>
                        </div>
                        <div class="file-input-wrapper">
                            <input type="file" id="folderInput" class="file-input" webkitdirectory multiple>
                            <label for="folderInput" class="file-input-label">
                                <span class="icon-folder"></span>
                                Select Folder
                            </label>
                        </div>
                    </div>
                </div>

                <div class="player-section">
                    <div class="player-top">
                        <div class="vinyl-container">
                            <div class="vinyl-disk" id="vinylDisk"></div>
                        </div>
                        
                        <div class="now-playing">
                            <div class="song-title" id="currentSongTitle">No song selected</div>
                            <div class="song-info" id="currentSongInfo">Select files to start playing</div>
                            <div class="song-meta">
                                <span id="currentArtist">Unknown Artist</span>
                                <span id="currentAlbum">Unknown Album</span>
                            </div>
                        </div>
                    </div>

                    <div class="progress-container">
                        <div class="progress-bar" id="progressBar">
                            <div class="progress-fill" id="progressFill"></div>
                        </div>
                        <div class="time-info">
                            <span id="currentTime">0:00</span>
                            <span id="totalTime">0:00</span>
                        </div>
                    </div>

                    <div class="controls">
                        <button class="control-btn" id="prevBtn" title="Previous">
                            <span class="icon-prev"></span>
                        </button>
                        <button class="control-btn" id="shuffleBtn" title="Shuffle">
                            <span class="icon-shuffle"></span>
                        </button>
                        <button class="control-btn play-pause-btn" id="playPauseBtn" title="Play/Pause">
                            <span class="icon-play"></span>
                        </button>
                        <button class="control-btn" id="repeatBtn" title="Repeat">
                            <span class="icon-repeat"></span>
                        </button>
                        <button class="control-btn" id="nextBtn" title="Next">
                            <span class="icon-next"></span>
                        </button>
                    </div>

                    <div class="volume-container">
                        <span class="volume-icon icon-volume" id="volumeIcon"></span>
                        <input type="range" id="volumeSlider" class="volume-slider" min="0" max="1" step="0.01" value="0.7">
                        <span class="volume-value" id="volumeValue">70%</span>
                    </div>

                    <audio id="audioPlayer" preload="metadata"></audio>
                </div>
            </div>

            <div class="queue-section">
                <div class="queue-header">
                    <div>
                        <div class="queue-title">Queue</div>
                        <div class="queue-count" id="queueCount">0 songs</div>
                    </div>
                    <div class="queue-controls">
                        <button class="queue-btn" id="clearBtn">Clear</button>
                    </div>
                </div>

                <div class="queue" id="queue">
                    <div class="empty-state">
                        <h3>No songs in queue</h3>
                        <p>Add music files to build your queue</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        class MusicPlayer {
            constructor() {
                this.audio = document.getElementById('audioPlayer');
                this.playlist = [];
                this.currentIndex = 0;
                this.isPlaying = false;
                this.isShuffled = false;
                this.repeatMode = 'none'; // 'none', 'one', 'all'
                this.shuffledIndices = [];
                this.draggedIndex = null;

                this.initializeElements();
                this.bindEvents();
                this.updateUI();
            }

            initializeElements() {
                this.fileInput = document.getElementById('fileInput');
                this.folderInput = document.getElementById('folderInput');
                this.playPauseBtn = document.getElementById('playPauseBtn');
                this.prevBtn = document.getElementById('prevBtn');
                this.nextBtn = document.getElementById('nextBtn');
                this.shuffleBtn = document.getElementById('shuffleBtn');
                this.repeatBtn = document.getElementById('repeatBtn');
                this.progressBar = document.getElementById('progressBar');
                this.progressFill = document.getElementById('progressFill');
                this.currentTime = document.getElementById('currentTime');
                this.totalTime = document.getElementById('totalTime');
                this.volumeSlider = document.getElementById('volumeSlider');
                this.volumeValue = document.getElementById('volumeValue');
                this.volumeIcon = document.getElementById('volumeIcon');
                this.currentSongTitle = document.getElementById('currentSongTitle');
                this.currentSongInfo = document.getElementById('currentSongInfo');
                this.currentArtist = document.getElementById('currentArtist');
                this.currentAlbum = document.getElementById('currentAlbum');
                this.queueElement = document.getElementById('queue');
                this.queueCount = document.getElementById('queueCount');
                this.clearBtn = document.getElementById('clearBtn');
                this.vinylDisk = document.getElementById('vinylDisk');
            }

            bindEvents() {
                this.fileInput.addEventListener('change', (e) => this.handleFileSelect(e));
                this.folderInput.addEventListener('change', (e) => this.handleFileSelect(e));
                
                this.playPauseBtn.addEventListener('click', () => this.togglePlay());
                this.prevBtn.addEventListener('click', () => this.previousTrack());
                this.nextBtn.addEventListener('click', () => this.nextTrack());
                this.shuffleBtn.addEventListener('click', () => this.toggleShuffle());
                this.repeatBtn.addEventListener('click', () => this.toggleRepeat());
                
                this.progressBar.addEventListener('click', (e) => this.seek(e));
                this.volumeSlider.addEventListener('input', (e) => this.setVolume(e.target.value));
                
                this.clearBtn.addEventListener('click', () => this.clearQueue());

                this.audio.addEventListener('loadedmetadata', () => this.updateDuration());
                this.audio.addEventListener('timeupdate', () => this.updateProgress());
                this.audio.addEventListener('ended', () => this.handleTrackEnd());
                this.audio.addEventListener('error', (e) => this.handleError(e));
                this.audio.addEventListener('play', () => this.vinylDisk.classList.add('spinning'));
                this.audio.addEventListener('pause', () => this.vinylDisk.classList.remove('spinning'));
            }

            handleFileSelect(event) {
                const files = Array.from(event.target.files);
                const audioFiles = files.filter(file => file.type.startsWith('audio/'));
                
                if (audioFiles.length === 0) {
                    alert('No audio files found!');
                    return;
                }

                audioFiles.forEach(file => {
                    const song = {
                        file: file,
                        title: file.name.replace(/\.[^/.]+$/, ""),
                        artist: 'Unknown Artist',
                        album: 'Unknown Album',
                        duration: null,
                        url: URL.createObjectURL(file)
                    };
                    this.playlist.push(song);
                });

                this.updateQueue();
                if (this.playlist.length === audioFiles.length) {
                    this.loadTrack(0);
                }
                this.generateShuffledIndices();
            }

            async loadTrack(index) {
                if (index < 0 || index >= this.playlist.length) return;
                
                this.currentIndex = index;
                const song = this.playlist[index];
                
                this.audio.src = song.url;
                this.currentSongTitle.textContent = song.title;
                this.currentSongInfo.textContent = `Track ${index + 1} of ${this.playlist.length}`;
                this.currentArtist.textContent = song.artist;
                this.currentAlbum.textContent = song.album;
                
                this.updateQueueHighlight();
                
                try {
                    await this.audio.load();
                } catch (error) {
                    console.error('Error loading track:', error);
                }
            }

            togglePlay() {
                if (this.playlist.length === 0) {
                    alert('Please add some music files first!');
                    return;
                }

                if (this.isPlaying) {
                    this.audio.pause();
                    this.playPauseBtn.querySelector('span').className = 'icon-play';
                    this.isPlaying = false;
                } else {
                    this.audio.play().then(() => {
                        this.playPauseBtn.querySelector('span').className = 'icon-pause';
                        this.isPlaying = true;
                    }).catch(error => {
                        console.error('Error playing audio:', error);
                        alert('Error playing this file. It may be corrupted or unsupported.');
                    });
                }
            }

            previousTrack() {
                if (this.playlist.length === 0) return;
                
                let newIndex;
                if (this.isShuffled) {
                    const currentShuffledIndex = this.shuffledIndices.indexOf(this.currentIndex);
                    const newShuffledIndex = currentShuffledIndex > 0 ? currentShuffledIndex - 1 : this.shuffledIndices.length - 1;
                    newIndex = this.shuffledIndices[newShuffledIndex];
                } else {
                    newIndex = this.currentIndex > 0 ? this.currentIndex - 1 : this.playlist.length - 1;
                }
                
                this.loadTrack(newIndex);
                if (this.isPlaying) {
                    setTimeout(() => this.audio.play(), 100);
                }
            }

            nextTrack() {
                if (this.playlist.length === 0) return;
                
                let newIndex;
                if (this.isShuffled) {
                    const currentShuffledIndex = this.shuffledIndices.indexOf(this.currentIndex);
                    const newShuffledIndex = (currentShuffledIndex + 1) % this.shuffledIndices.length;
                    newIndex = this.shuffledIndices[newShuffledIndex];
                } else {
                    newIndex = (this.currentIndex + 1) % this.playlist.length;
                }
                
                this.loadTrack(newIndex);
                if (this.isPlaying) {
                    setTimeout(() => this.audio.play(), 100);
                }
            }

            toggleShuffle() {
                this.isShuffled = !this.isShuffled;
                this.shuffleBtn.classList.toggle('active', this.isShuffled);
                
                if (this.isShuffled) {
                    this.generateShuffledIndices();
                }
            }

            toggleRepeat() {
                const modes = ['none', 'all', 'one'];
                const currentIndex = modes.indexOf(this.repeatMode);
                this.repeatMode = modes[(currentIndex + 1) % modes.length];
                
                this.repeatBtn.classList.toggle('active', this.repeatMode !== 'none');
                
                const iconClass = this.repeatMode === 'one' ? 'icon-repeat-one' : 'icon-repeat';
                this.repeatBtn.querySelector('span').className = iconClass;
            }

            generateShuffledIndices() {
                this.shuffledIndices = [...Array(this.playlist.length).keys()];
                for (let i = this.shuffledIndices.length - 1; i > 0; i--) {
                    const j = Math.floor(Math.random() * (i + 1));
                    [this.shuffledIndices[i], this.shuffledIndices[j]] = [this.shuffledIndices[j], this.shuffledIndices[i]];
                }
            }

            seek(event) {
                if (!this.audio.duration) return;
                
                const rect = this.progressBar.getBoundingClientRect();
                const clickX = event.clientX - rect.left;
                const percentage = clickX / rect.width;
                const newTime = percentage * this.audio.duration;
                
                this.audio.currentTime = newTime;
            }

            setVolume(value) {
                this.
